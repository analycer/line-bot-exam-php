<?PHP

	$SGB_URL			= "http://admin.shininggold.com/ui";
		
	// Font Sizes
	$extra_huge			= "<font style='font-size: 48px;'>";
	$huge				= "<font style='font-size: 22px;'>";
	$bigfont			= "<font size='4'>";
	$small				= "<font style='font-size: 11px;'>";
	$tiny				= "<font style='font-size: 8px;'>";

	// Align
	$left				= "<div align='left'>";
	
	// Colors
	$hex_purple			= "#E1BAE1";
	$hex_dark_purple	= "#5C255C";
	$hex_white			= "#FFFFFF";
	$hex_red			= "#FFD5D5";
	$hex_pink			= "#F6CECE";
	$hex_green			= "#A9F5A9";	
	$hex_yellow			= "#DFB824";
	$hex_grey			= "#A6A6A6";
	$hex_black			= "#000000";

	$hex_nice_green		= "#22B14C";
	$hex_nice_red		= "#DC3912";
	$hex_nice_orange	= "#e7711b";
	$hex_nice_blue		= "#1155CC";
	$hex_nice_yellow	= "#FF9900";
	
	$green 				= "<font color='$hex_nice_green'><b>";
	$red				= "<font color='$hex_nice_red'><b>";
	$red_pure			= "<font color='#FF0000'><b>";
	$yellow				= "<font color='$hex_yellow'><b>";
	$blue				= "<font color='$hex_nice_blue'><b>";
	$orange				= "<font color='#EC9200'><b>";		
	$white				= "<font color='$hex_white'><b>";
	$purple				= "<font color='$hex_purple'><b>";
	$dark_purple		= "<font color='$hex_dark_purple'><b>";
	$grey				= "<font color='$hex_grey'>";
	$black				= "<font color='$hex_black'><b>";

	$green_number		= "<font class='number' color='$hex_nice_green'><b>";
	$red_number			= "<font class='number' color='$hex_nice_red'><b>";
	
	$COLOR_END			= "</font></b>";
	$DIV_END			= "</div>";
	
	
	$img_yes			= "<img src='./img/yes.png' alt='yes' />";
	$img_no				= "<img src='./img/no.png' alt='no' width='20px' />";
	
	$img_goal			= "<img src='./img/goal.png' alt='goal' />";
	
	$img_up				= "<img src='./img/up.png' alt='up' width='15px' />";
	$img_down			= "<img src='./img/down.png' alt='down' width='15px' />";
	
	$img_in				= "<img src='./img/in.png' title='IN' width='25px' />";
	$img_out			= "<img src='./img/out.png' title='OUT' width='25px' />";
	
	$img_match			= "<img src='./img/match.png' alt='match' width='20px' />";
	$img_gold			= "<img src='./img/gold.png' alt='gold' width='20px' />";
	$img_gold_mini		= "<img src='./img/gold.png' alt='gold' width='10px' />";
	$img_money			= "<img src='./img/money.png' alt='money' width='20px' />";
	$img_money_mini		= "<img src='./img/money.png' alt='money' width='10px' />";
	$img_baht			= "<img src='./img/baht.png' alt='gold' width='20px' />";

	$img_arrow			= "<img src='./img/arrow_right.png' width='10px' />";
	$img_arrow_left		= "<img src='./img/arrow_left.png' width='10px' />";
	$img_warning		= "<img src='./img/warning.png' width='20px' />";
	$img_empty			= "<img src='./img/empty.png' width='25px' />";
	$img_chart			= "<img src='./img/chart.png' width='25px' />";
	$img_graph			= "<img src='./img/graph.png' width='25px' />";
	$img_volume			= "<img src='./img/volume.png' width='25px' />";
	$img_home			= "<img src='./img/home.png' alt='H' width='25px' />";
	$img_mobile			= "<img src='./img/mobile.png' alt='M' width='20px' />";
	$img_personal		= "<img src='./img/personal.png' alt='M' width='20px' />";
	$img_confirm		= "<img src='./img/confirm.png' alt='confirm' width='20px' title='confirm' />";
	$img_done			= "<img src='./img/done.png' alt='done' width='20px' title='complete' />";
	$img_ats			= "<img src='./img/ats.png' alt='ats' width='20px' />";
	$img_clearing		= "<img src='./img/clearing.png' alt='clearing' title='เคลียร์บัญชี' width='20px' />";
	$img_both			= "<img src='./img/both.png' alt='both' width='20px' />";
	$img_route			= "<img src='./img/route.png' alt='clearing' title='ลูกค้ารูท' width='20px' />";
	$img_book			= "<img src='./img/book.png' alt='book' width='25px' />";
	$img_delivery		= "<img src='./img/delivery.png' alt='delivery' width='25px' />";
	$img_bullet			= "<img src='./img/bullet.png' alt='delivery' width='15px' />";
	$img_update			= "<img src='./img/update.png' alt='delivery' width='15px' />";
	$img_dashboard		= "<img src='./img/dashboard.png' alt='delivery' width='20px' />";
	$img_pp				= "<img src='./img/promptpay.png' alt='PromptPay' width='300' />";
	$img_block			= "<img src='./img/block.png' alt='ค่าบล๊อค' title='ค่าบล๊อค' width='15px' />";

	$img_blinking_red	= "<img src='./img/blinking_red.gif' alt='PromptPay' width='15' />";
	
	// BANKS
	$img_kbank			= "<img src='./img/banks/KBANK.png'  width='50px' />";
	$img_scb			= "<img src='./img/banks/SCB.png'  width='50px' />";
	$img_bbl			= "<img src='./img/banks/BBL.png' width='50px'  />";
	$img_bay			= "<img src='./img/banks/BAY.png'  width='50px' />";
	$img_ktb			= "<img src='./img/banks/KTB.png'  width='50px' />";
	$img_uob			= "<img src='./img/banks/UOB.png'  width='50px' />";
	$img_tmb			= "<img src='./img/banks/TMB.png'  width='50px' />";
	$img_tbank			= "<img src='./img/banks/TBANK.png'  width='50px' />";
	$img_cash			= "<img src='./img/banks/CASH.png'  width='40px' />";

	// SUPP
	$img_g4s			= "<img src='./img/supp/g4s.png'  width='60px' />";
	$img_brinks			= "<img src='./img/supp/brinks.png'  width='60px' />";
	$img_standard		= "<img src='./img/supp/standard.png' height='25' />";
	$img_mks			= "<img src='./img/supp/mks.png'  width='30px' />";
	$img_intl			= "<img src='./img/supp/intl.png'  height='30px' />";

	// -------------------------------------------- HTML ------------------------------------------
	
	/* Table Operations
			$TOPEN		
			$BOR aaa $COL bbb $COL ccc $EOR
			$TCLOSE
	*/
	$TABLE_CLASS		= " class='table-striped table-bordered ' id='maintable' ";
	$TABLE_100_CLASS	= " class='table table-striped table-bordered ' id='maintable' ";

	$TABLE_CLASS_NB		= "   ";
	$A_CLASS			= " ";
	$BUTTON_CLASS		= "class='' "; // https://getbootstrap.com/docs/4.0/components/buttons/
	$INPUT_CLASS		= "class='form-control form-control-sm' ";
	$SELECT_CLASS		= "class='form-control form-control-sm' ";

	$TOPEN				= "<table $TABLE_CLASS >";
	$TOPEN_100			= "<table $TABLE_100_CLASS width='100%' >";
	$TOPEN_30			= "<table $TABLE_CLASS width='30%' >";
	$TOPEN_50			= "<table $TABLE_CLASS width='50%' >";
	$TOPEN_60			= "<table $TABLE_CLASS width='60%' >";
	$TOPEN_80			= "<table $TABLE_CLASS width='80%' >";

	$TOPEN_NB			= "<table $TABLE_CLASS_NB border='0'  >";
	$TOPEN_NB_100		= "<table $TABLE_CLASS_NB border='0' width='100%' >";
	$TOPEN_NB_50		= "<table $TABLE_CLASS_NB border='0' width='50%' >";
	$TOPEN_NB_80		= "<table $TABLE_CLASS_NB border='0' width='80%' >";

	$BOR				= "<tr valign='top' class='text-center'><td>";
	$COL				= "</td><td>";
	
	function BOR_H($span) { return "<tr><th colspan='$span'>"; }
	function COL_H($span) { return "</th><th colspan='$span'>"; }
	function BOR($span) { return "<tr><td colspan='$span'>"; }
	function COL($span) { return "</td><td colspan='$span'>"; }
	$EOR				= "</td></tr>";
	$BOR_H				= "<tr class='text-center'><th>";
	$COL_H				= "</th><th>";
	$EOR_H				= "</th></tr>";	
	$TCLOSE				= "</table>";
	$NR					= "<br>";
	$HR					= "<hr>";
	$center				= "<center>";
	$THEAD				= "<thead>";
	$TBODY				= "</thead><tbody>";
	$TBODY_C			= "</tbody>";

	//--------------------------
	// Bootstrap Stuffs
	//--------------------------
	$DR					= "<div class='row'>";
	$DC					= "<div class='col'>";
	$DCOL				= "</div>$DC";
	$D					= "</div>";
	$DD					= "$D$D";

	function GROUP ($label) { return "<div class='input-group'><div class='input-group-prepend'><span class='input-group-text' id=''>$label</span></div>"; }
	
	$NOTE				= "<div class='alert' role='alert'>";
	$ALERT				= "<div class='alert alert-danger' role='alert'>";

	function A ($string, $URL, $title = '') { global $A_CLASS; return "<a href='$URL' target='_blank' title='$title' $A_CLASS > $string </a> "; }

	function BUTTON ($string, $URL) { global $BUTTON_CLASS; return "<button formaction='$URL' formtarget='_blank' $BUTTON_CLASS > $string </button> "; }

	$SUBMIT_BUTTON		= " <button type='submit' $BUTTON_CLASS >OK</button>";

	/* Usage:
		$CAROUSEL_HEADER
			$CAROUSEL_ACTIVE 		active item 		$D (ต้องมี)
			$CAROUSEL_ITEM 			active item 		$D
			...
		$CAROUSEL_FOOTER
	*/
	$C_HEADER	= "	<div id='carouselExampleControls' class='carousel slide' data-ride='carousel'>	<div class='carousel-inner'> ";
	$C_ACTIVE	= " <div class='carousel-item active'> ";
	$C_ITEM		= " <div class='carousel-item'> ";
	$C_FOOTER	= " </div> <!-- innser -->
								<a class='carousel-control-prev' href='#carouselExampleControls' role='button' data-slide='prev'>
									<span class='carousel-control-prev-icon' aria-hidden='true'></span>
									<span class='sr-only'>Previous</span></a>
								<a class='carousel-control-next' href='#carouselExampleControls' role='button' data-slide='next'>
									<span class='carousel-control-next-icon' aria-hidden='true'></span>
									<span class='sr-only'>Next</span></a>
							</div> <!-- carousel -->";

	// -------------------------------------------------- JS --------------------------------------------------
	function alert ($msg) {		echo "<script> alert('$msg'); </script>";		}
	
	// -------------------------------------------- REFORMAT / PRINT ------------------------------------------
	
	
	// Shorten version of number_format
	// string number_format ( float $number , int $decimals = 0 , string $dec_point = "." , string $thousands_sep = "," )
	function nf ($number, $decimal = 0)
	{ return ( !is_numeric($number) || ($number == 0) || empty($number)) ? '' : "<font class='number'>".number_format($number, $decimal)."</font>"; }
	
	// If zero, return zero 
	// Remove thousand separator (not google chart safe) ** no css/style
	function nf_chart_safe ($number, $decimal = 0)
	{ return ( !is_numeric($number) || ($number == 0) || empty($number)) ? 0 : number_format($number, $decimal, ".", ""); }

	// Format dollar (+/-)$
	function dollar ($number, $decimal = 0)
	{	
		if ($number)
			return "$".nf($number, $decimal);
		else
			return '';
	}
	function dollar_cf ($number, $decimal = 0)
	{
		global $green, $red, $COLOR_END;
		
		if ($number > 0)
			return $green.'+'.dollar ($number, $decimal).$COLOR_END;
		else if ($number < 0)
			return $red.'-'.dollar (abs($number), $decimal).$COLOR_END;
		else
			return '';
	}
	
	// Format dollar (+/-)$
	function baht ($number, $decimal = 0)
	{	
		if ($number)
			return '฿'.nf($number, $decimal);
		else
			return '';
	}
	function baht_cf ($number, $decimal = 0)
	{
		global $green, $red, $COLOR_END;
		
		if ($number > 0)
			return $green.'+'.baht ($number, $decimal).$COLOR_END;
		else if ($number < 0)
			return $red.'-'.baht (abs($number), $decimal).$COLOR_END;
		else
			return '';
	}
	
	function nf_sign ($number, $decimal = 0)
	{
		if ($number > 0)
			return '+'.nf ($number, $decimal);
		else if ($number < 0)
			return '-'.nf (abs($number), $decimal);
		else
			return 0;
	}
	
	// Shorten version of color_format
	function cf ($number, $decimal = 0)
	{ 
		global $green_number, $red_number, $COLOR_END;
	
		if (($number == 0) || empty($number))
			return '';		
		if ($number < 0)
			return $red_number.number_format($number, $decimal).$COLOR_END;
		else if ($number > 0)
			return $green_number.number_format($number, $decimal).$COLOR_END;	
	}
	
	// Shorten version of color_format
	function cf_sign ($number, $decimal = 0)
	{ 
		global $green_number, $red_number, $COLOR_END;
	
		if (($number == 0) || empty($number))
			return '';		
		if ($number < 0)
			return $red_number.number_format($number, $decimal).$COLOR_END; 
		else if ($number > 0)
			return $green_number.'+'.number_format($number, $decimal).$COLOR_END; // ต้อง format '+' ด้วย ห้ามลบ
	}
	
	function percentage ($number, $decimal = 0)
	{	
		if ($number)
			return nf($number * 100, $decimal).'%';
		else
			return '';
	}

	
	// Usage : $header = array("abc","def");
	//		   replace print_row($header,true);
	function pr ($columns, $header = false)
	{
		$row = $header ? "th" : "td" ;
		
		echo "<tr>";
		
		foreach ($columns as $value)
		{	
			if ($value == "|") 		echo "<th> </th>"; // separator
			else					echo "<$row class='text-center'>$value</$row>";
		}
		
		echo "</tr>";
		unset($value);
	}
	
	// Usage : $header = array("abc","def");
	//		   replace print_row($header,true);
	function pr_header ($value, $colspan = 1, $color = "white")
	{
		echo "<tr><td colspan='$colspan' bgcolor='$color'>$value</td></tr>";
	}
	function pr_header_buff ($value, $colspan = 1, $color = "white")
	{
		return "<tr><td colspan='$colspan' bgcolor='$color'>$value</td></tr>";
	}

	
	// print one row
	// return what is printed
	function pr_buff ($columns, $header = false)
	{
		$row = $header ? "th" : "td" ;
		
		$buffer = "<tr>";
		
		foreach ($columns as $value)
		{	
			if ($value == "|") 
				$buffer .= "<th></th>"; // separator
			else
				$buffer .= "<$row  class='text-center'>$value</$row>";
		}
			
		$buffer .= "</tr>";
		
		unset($value);
		return $buffer;
	}
	
	function pr_buff_color ($columns, $color = "white")
	{
		$buffer = "<tr>";
		
		foreach ($columns as $value)
		{	
			if ($value == "|") 
				$buffer .= "<th></th>"; // separator
			else
				$buffer .= "<td class='text-center' bgcolor='$color'>$value</td>";
		}
			
		$buffer .= "</tr>";
		
		unset($value);
		return $buffer;
	}
	
	
	// print one row
	// return what is printed
	function pr_color ($columns, $color = "white")
	{		
		echo "<tr>";
		
		foreach ($columns as $value)
		{	
			if ($value == '|') 
				echo "<th></th>"; // separator
			else
				echo "<td class='text-center' bgcolor='$color'>$value</td>";
		}
		
		echo "</tr>";
		unset($value);
	}
	
	function print_row_color ($columns, $color = "white")
	{		
		echo "<tr>";
		
		foreach ($columns as $value)
		{	
			if ($value == '|') 
				echo "<td bgcolor='$color'></td>"; // separator
			else
				echo "<td bgcolor='$color'>$value</td>";
		}
		
		echo "</tr>";
		unset($value);
	}

	// Reformat number and color
	// positive : green <formated>
	// zero		: <formated>
	// negative : red <formated>
	function color_format($number, $decimal = 0)
	{
		global $green, $red;
	
		if ($number < 0)
			return $red.number_format($number, $decimal);
		else if ($number > 0)
			return $green.number_format($number, $decimal);
		else
			return '';			
	}
	
	// Reformat phone number 
	function phone_format ($number)
	{
		$len = strlen($number);
		$number = trim($number);
		
		if ($len == 10) // mobile
			return substr($number,0,3).'-'.substr($number,3,3).'-'.substr($number,6);
		else if ($len == 9) // home
			return substr($number,0,2).'-'.substr($number,2,3).'-'.substr($number,5);
		
		return $number;
	}	
	
	
	// ถ้าค่าไม่เป็นว่างๆ หรือ 0 จะ return $string . nf($value)
	function pinz ($string, $number, $decimal = 0) {
		if ( !is_numeric($number) || ($number == 0) || empty($number)) { return ''; }
		return $string.nf($number,$decimal);
	}	

	function pine ($string, $string_check, $decimal = 0) {
		if ( $string_check == '' || empty($string_check)) { return ''; }
		return $string.$string_check;
	}	
	
	function debug ($msg, $DEBUG = TRUE)
	{	
		if ($DEBUG && $_SESSION['usertype'] == "admin" ) {	
			ob_start();  				// output buffer
			print_r($msg);  			// better than var_dump
			$out = ob_get_clean();  	// flush output
			echo "<div align='left'><pre>".$out."</pre></div>";
		}
	}
	
	function getType2 ($type) {
		global $green, $red, $COLOR_END;

		switch ($type) {
			case 'buy': return $green.'B'.$COLOR_END;
			case 'sell': return $red.'S'.$COLOR_END;
			default: return $type;
		}
	}

	function getThaiDate ($strDate, $showYear = FALSE, $showDayofWeek = TRUE)
	{
		if (!isset($strDate)) $strDate = date("Y-m-d");
		
		$strYear 		= date("Y",strtotime($strDate)) + 543 - 2500;
		$strMonth 		= date("n",strtotime($strDate));
		$strDay 		= date("j",strtotime($strDate));
		
		$strDayofWeek 	= date("N",strtotime($strDate));
		$dayArry		= array("","จันทร์","อังคาร","พุธ","พฤหัส","ศุกร์","เสาร์","อาทิตย์");
		$strDayofWeekTH	= $dayArry[$strDayofWeek];
		
		
		$strMonthCutx 	= Array("","ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค.");
		$strMonthThai 	= $strMonthCutx[$strMonth];
			
		return ($showDayofWeek ? $strDayofWeekTH : '')." $strDay $strMonthThai" . ($showYear ? " ".$strYear : '');
	}

	function getBankImage ($bank) { 

		GLOBAL $img_kbank,  $img_scb, $img_bbl, $img_bay, 
				$img_ktb, $img_uob, $img_tmb, $img_tbank, $img_cash;

		switch ($bank) {
			case 'bbl': case 'BBL'		:   return $img_bbl;
			case 'kbank': case 'KBANK'	:   return $img_kbank; 
			case 'bay': case 'BAY'		:   return $img_bay; 
			case 'ktb': case 'KTB'		:  	return $img_ktb; 
			case 'tmb': case 'TMB'		:  	return $img_tmb; 
			case 'scb': case 'SCB'		:	return $img_scb;
			case 'uob': case 'UOB'		:   return $img_uob; 
			case 'tbank': case 'TBANK'	: 	return $img_tbank;	
			default						:	return $bank;
		}

	}

	function tooltip ($text) {
		return "<img src='./img/tooltip.png' title='$text' width='15px' />";
	}

	function getDeliveryRatio ($step) {

		switch ($step) {
			case '0': return 0.0;
			case '1': return 0.1;
			case '2': return 0.3;
			case '3': return 0.5;
			case '4': return 0.7;
			case '5': return 0.9;
		}

	}

	function getDeliveryScale ($ratio) {

		if ($ratio == 0) return '0';
		if ($ratio > 0.0 && $ratio <= 0.2) return '1'; 
		if ($ratio > 0.2 && $ratio <= 0.4) return '2'; 
		if ($ratio > 0.4 && $ratio <= 0.6) return '3'; 
		if ($ratio > 0.6 && $ratio <= 0.8) return '4';
		if ($ratio > 0.8) return '5'; 

	}

	// -------------------------------------------- CHECK -----------------------------------------------


	// Check user function, will destroy session if user type not in array
	// Admin has all access
	// Need TRUE/FALSE to display menu !!!
	function checkUser ($types)
	{
		foreach ($types as $usertype) 
		{
			// echo "		($_SESSION[usertype] == $usertype)";

			if (
				$_SESSION['usertype'] == $usertype or 
				$_SESSION['usertype'] == "admin" 
				)
				return true;
		}
		
		return false;
	}
	
	
	
	function data_cmp ($a, $b, $ind)
	{	
		// Set defaults
		if (empty($a[$ind])) $a[$ind] = '';
		if (empty($b[$ind])) $b[$ind] = '';
		
		//echo $NR.$a[$ind];
				
		if (strtotime($a[$ind]) == strtotime($b[$ind])) return 0;		// equal
		return (strtotime($a[$ind]) < strtotime($b[$ind])) ? -1 : 1;	// compare
	}
	
	
	
	// -------------------------------------------- GET -----------------------------------------------
	
	
	function getTeamName ($team_id)
	{	
		if ($team_id == 1)		return "BRAVO";
		else if ($team_id == 2)	return "BINGO!!!";
		else if ($team_id == 3)	return "เสือใต้";
		else if ($team_id == 4)	return "ปลีก";
		
		return "SGB";
	}
	
	// For query mark_user_id within the same team
	// return NULL if $group is empty
	function getMarkID_from_group ($team_id) // ============= ใส่ใน getMemberName ด้วย =================================
	{
		if (empty($team_id)) return NULL;
		
		if ($team_id == 1) 	return "26,27,369,1018,1644,29,1766,1849,1911,1978"; // ปุ้ย
		if ($team_id == 2)	return "1001,767,1000,240,2141,2619,2659";					// หวาน
		if ($team_id == 3) 	return "1102,1431,1318,1156,1900,2017,2281";			// อาร์ม
		if ($team_id == 4) 	return "2094";			// เก๋
		
		return NULL;	
	}
	
	function getMemberName ($team_id)
	{
		if (empty($team_id)) return NULL;
		
		if ($team_id == 1) 	return array("กร","ปุ้ย","กี้","แยม","บาส","พิม","บอล","เอ้","ต้น","แอ้ม");
		if ($team_id == 2)	return array("หวาน","จอย","มาย","เปา","แป้ง","บอส","ก้อย");
		if ($team_id == 3) 	return array("อาร์ม","สิ","เก๋","ภู","วิน","หนิง","ปลั๊ก","วุฒ");
		if ($team_id == 4) 	return array("เก๋2");
		
		return NULL;	// หวาน ก้อย มาย บอส ปุ้ย แยม
	}
	
	
	$GLOBALS['ateam_name']	= "BRAVO";
	$GLOBALS['ateam']		= array("กร", "แยม", "กี้", "ปุ้ย", "บาส", "พิม","บอล","เอ้","แอ้ม");
	
	$GLOBALS['bteam_name']	= "BINGO!!!";
	$GLOBALS['bteam']		= array("หวาน", "จอย", "เปา", "มาย","แป้ง","บอส");	
	
	$GLOBALS['cteam_name']	= "เสือใต้";
	$GLOBALS['cteam']		= array("อาร์ม", "เก๋", "ภู", "สิ", "หนิง", "ปลั๊ก","วุฒ");
	
	$GLOBALS['dteam_name']	= "ปลีก";
	$GLOBALS['dteam']		= array("เก๋2");
	
	// Marketing ที่ลาออกไปแล้ว
	$ignored_mark_id = "(130,557,20,615,19,300,330,131,468,558,556,792,29,1019,1795,1455,558,1155,369,767,
							26,1102,1318,1641,1644,1839,1849,1863,1900,2094,2220,
							2250,2251,2252)"; // ไม่ควรเพิ่ม ลูกค้าบริษัท (โบรคอื่น,เว็บไซท์,กระเป๋า,แนะนำ ฯลฯ) query จะไม่ดึง volumn จะหาย
	
	
	$ignore_cust_id = "(
							/* กนก */ '1497'
						)";
	
	// $data = getCurrentPrice();
	function getCurrentPrice () 
	{
		$URL 	= "https://price.shininggold.com/get_current_prices";
		$json 	= file_get_contents($URL);
		$data	= json_decode($json, true);
		if (empty($data)) return NULL;
		return 	$data;
	}		
	
	function cannotGetCurrentPrice()
	{
		global $red_pure, $COLOR_END;
		echo "$red_pure <br> <center> ** ไม่สามารถดึงราคาปัจจุบันได้ ** </center> <br> $COLOR_END";
	}
	
	function getShopType ($shop_type)
	{
		// Reformat shop_type
		if ($shop_type == "retail_s")
			return "ร้านเล็ก";
		else if ($shop_type == "retail_m")
			return "ร้านกลาง";
		else if ($shop_type == "retail_l")
			return "ร้านใหญ่";
		else if ($shop_type == "wholesale")
			return "ร้านส่ง";
		else if ($shop_type == "persona")
			return "บุคคล";
		else if ($shop_type == "bill")
			return "ซอยบิล";
		else if ($shop_type == "broker")
			return "โบรคฯ";
		else if ($shop_type == "other")
			return "อื่นๆ";
		else if ($shop_type == "company")
			return "บริษัท";
		else if ($shop_type == "spot")
			return "Spot";
		else if ($shop_type == "local_spot")
			return "Local Spot";
		else
			return $shop_type;
	}	
	
	function getTType ($ttype)
	{
		global $blue, $COLOR_END, $small;

		if ($ttype == "delivery")	$s = "Delivery";
		else if ($ttype == "match") $s = "Match";
		else if ($ttype == "both") 	$s = "Both";
		else if ($ttype == "other") $s = "Other";
		else						$s = $ttype;

		return $small.$blue.$s.$COLOR_END.$COLOR_END;
	}	
	
	function getUOM ($uom)
	{
		if ($uom == "baht")
			return "บ.";
		else if ($uom == "oz")
			return "ออนซ์";
		else if ($uom == "g")
			return "กรัม";
		else
			return $uom;
	}
	
	function getKGDefault ($qty, $uom, $product) {
	
		if ($uom == "") return getKGFromProduct ($qty, $product);
		else 			return getKG ($qty, $uom);
	}
	
	function getKG ($qty, $uom)
	{
		if ($uom == "baht")
			return $qty / 65.6 * 96.5 / 99.99;
		else if ($uom == "oz")
			return $qty / 32.148;
		else if ($uom == "g")
			return $qty / 1000;
		else if ($uom == "kg")
			return $qty;
		
		echo "<br>Cannot get KG $qty/ $uom/";
		return -1;
		
	}
	
	function getKGFromProduct ($qty, $product)
	{
		if ($product == "96")
			return getKG ($qty, "baht");
		else if ($product == "99_lbma")
			return getKG ($qty, "kg");
		else if ($product == "96_mini") 
			return getKG ($qty, "baht");
		else if ($product == "99_spot") 
			return getKG ($qty, "kg");
			
		echo "<br>Cannot get KG from Product : $qty $product";
		return -1;
		
	}
	
	// Convert Qty from SPOT to BATH 
	function getBaht ($qty, $uom)
	{
		if ($uom == "oz")
			return $qty * 0.49;
		else if ($uom == "g")
			return $qty / 15.244;
		else if ($uom == "kg")
			return $qty * 65.6;	
		else
			return $qty;
	}
	
	function baht96ToKG99 ($qty) 
	{
		//return $qty / 65.5995 * 96.5 / 99.99;
		return $qty * 15.244 * 96.5 / 99.99 / 1000;
	}
	
	function getProduct ($product)
	{
		global $blue, $orange, $yellow, $COLOR_END, $purple;
	
		if ($product == "99_spot") 		return $orange."99s".$COLOR_END;
		else if ($product == "99_lbma") return $blue."99".$COLOR_END;
		else if ($product == '96') 		return $yellow.'96'.$COLOR_END;	
		else if ($product == '96_mini') return $purple."96 Mini".$COLOR_END;
		return $product;
	}
	
	function get99Price ($price, $product = "96")
	{
		if ($product == "96")
			return ($price * 99.99 / 96.5);
		else 
			return $price;
	}
	
	function getRegion ($region) {
		switch ($region) {
			case "east" : return "ตะวันออก";
			case "west" : return "ตะวันตก";
			case "north_east" : return "ตะวันออกเฉียงเหนือ";
			case "south" : return "ใต้";
			case "central" : return "กลาง";
			case "perimeter" : return "ปริมณฑล";
			case "bangkok" : return "กรุงเทพ";
			case "other" : return "อื่นๆ";
			default 	: return "-";
		}
	}

	function getBookingType ($type) {
		switch ($type) {
			case "buy" 	: return "จองทอง";
			case "sell"	: return "จองเงิน";
			case "both"	: return "โอนไป/กลับ";
			case "operation" : return "ภายใน";
			default 	: return '-';
		}
	}

	function getImexBookingType ($type) {
		if ($type == 'out') 			return 'ส่งออก';
		else if ($type == 'in') 		return 'นำเข้า';
		else if ($type == 'freezone') 	return 'เวียนเรท';
		else return $type;
	}

	function getImexBookingNote ($type) {
		if ($type == 'customer') 		return 'ให้ลูกค้า';
		else if ($type == 'freezone')	return 'Free-Zone';
		else if ($type == 'factory') 	return 'ส่งโรงงาน';
		else if ($type == 'etc')	 	return 'อื่นๆ';
		else return $type;
	}
	
	// -------------------------------------------- CALCULATE -----------------------------------------------
	
	// Calculate cost (default product = 99)
	// $total = cost x qty
	// $converter = (convert to spot = RATE / convert to rate = SPOT)
	// usage: calCost (1300000, 1, 32.15, false) 	-> cost spot 1320 (96.5)
	// 		  calCost (1300000, 1, 1320,  true)		-> cost rate 32.15 (99.99)
	function calCost ($total, $qty, $converter, $is96 = false)
	{
		if (($total == 0) OR ($qty == 0) OR ($converter == 0)) 
			return 0;		
			
		return $is96 
				? ($total / $qty) / 0.49 / $converter * 99.99 / 96.5 // convert back to 96
				: ($total / $qty) / 0.49 / $converter; // normal
	}
	
	
	
	
	// Mark to Market : Match minimum first, then close the rest at market price
	// 					Just forward to m2m_separate()
	function m2m ($buy_total, $buy_qty, $sell_total, $sell_qty, $bid, $ask)
	{
		$final_pl = m2m_separate ($buy_total, $buy_qty, $sell_total, $sell_qty, $bid, $ask);
		return $final_pl['INITIAL'] + $final_pl['UNREALIZED'];
	}
	
	// Mark to Market : Match minimum first, then close the rest at market price
	// Return : Array of INITIAL and UNREALIZED
	function m2m_separate (	$buy_total, $buy_qty, $sell_total, $sell_qty, $bid, $ask)
	{
		$final_pl = array();
		$avg_buy = $avg_sell = 0;
		
		// A. try to match B/S first
		$diff_qty		= $sell_qty - $buy_qty;
		
		// B. Get avg buy/sell price
		$avg_buy		= @($buy_total / $buy_qty);			
		$avg_sell		= @($sell_total / $sell_qty);
		
		// C. Match minimum
		$final_pl['INITIAL']	= ($avg_sell - $avg_buy) * min($sell_qty, $buy_qty); // B = S
		
		// D. Close remain on market price
		if ($diff_qty > 0) 		$final_pl['UNREALIZED'] = ($avg_sell - $ask) * abs($diff_qty); // S > B have to Buy
		else if ($diff_qty < 0) $final_pl['UNREALIZED'] = ($bid - $avg_buy) * abs($diff_qty); // B > S have to Sell
		else 					$final_pl['UNREALIZED'] = 0;

		return $final_pl;
	}
	

	function diffDay ($from, $to)
	{	
		$diff_dates 	= strtotime($to) - strtotime($from); // seconds
		if ($diff_dates < 0) return 0;
		return ($diff_dates / 60 / 60 / 24);	// days
	}

	function diffDay_lib ($d1, $d2) {
		$date1 = new DateTime($d1);
		$date2 = new DateTime($d2);
		return $date2->diff($date1)->format('%a');
	}

	function isUpdatedToday ($updated) {
		//echo "<br>".$updated.": ".floor(strtotime($updated) / 60 / 60 /24) .">=". floor(time() / 60 / 60 /24);
		return floor(strtotime($updated) / 60 / 60 /24) >= floor(time() / 60 / 60 /24);
	}

	// คำนวนว่าสต๊อกจริงมีเท่าไหร่
	function payable_stock ($stock, $sell) {
		if (abs($stock) == $sell) 	return 0;		// ขายไม่มีสต๊อก
		else if ($sell == 0) 		return $stock;	// ไม่ได้ขาย
		return $stock + $sell;
	}
	
	
	// -------------------------------------------- GOOGLE CHART ----------------------------------------
	
	$INCLUDE_CHART 			= "<script type='text/javascript' src='https://www.google.com/jsapi'></script>";	
	$INCLUDE_CHART_MATERIAL = "<script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>";
	
	// Options
	$NO_LEGEND 			= "legend: {position: 'none'}";
	$BUTTOM_LEGEND		= "legend: {position: 'bottom'}";
	$IN_LEGEND			= "legend: {position: 'in'}";
	$BUY_SELL_SERIES	= "series: { 0: { color: '#83bf59' }, 1: { color: '#e2431e' } }";
	$MAXIMIZE 			= "chartArea: {left:20,top:20, width:'100%',height:'100%'}";
	

	/*

		$series = " ['task', 'hours'] ";
		$data .= " dataset ( 'Work', array( nf_chart_safe( 11,2) )
							);

	*/
	function drawChart ($header, $width, $height, $series, $data, $options, $type = "LineChart")
	{	
		$randomID = mt_rand (1,10000);
	
		return "<h3>$header</h3>
			<script type='text/javascript'>
				google.load('visualization', '1', {packages:['corechart']});
				google.setOnLoadCallback(drawChart);
				
				function drawChart() 
				{
					var data 		= google.visualization.arrayToDataTable([$series,$data]);
					var options 	= { $options ,  
										'chartArea': {'width': '80%', 'height': '80%'}    };
					var chart 		= new google.visualization.$type(document.getElementById('$randomID'));
					chart.draw(data, options);
				}
			</script>
			<div id='$randomID' style='width: $width; height: $height;'></div>";
	}
	
	
	/*	
		=====
		DATA
		=====

		$bs .= dataset ( $rc[month] , array( 
								nf_chart_safe ($rc['import'],1) ,
								nf_chart_safe ($rc['export'],1) ,
								nf_chart_safe ($sum_import / $month ,1),
								nf_chart_safe ($sum_export / $month ,1),
 								 get_spot_price_from_week($rc['month'], $prev_spot)
								)
						);
		
		======
		TYPE
		======

		$series['Day'] 		= 'string';
		$series['รับ 965'] 	= 'number';
		$series['รับ 99'] 		= 'number';
		$series['รับ 99 spot'] 	= 'number';
		$series['เฉลี่ย'] 		= 'number';

		=======
		OPTION
		=======

		$options = "
			series: {
			  0: {axis: 'qty'},
			  1: {axis: 'qty'},
			  2: {axis: 'qty'},
			  3: {axis: 'qty'},
			  4: {axis: 'spot'}
		   },
			axes: {
			  y: {
				qty: {label: 'IMEX'},
				spot: {label: 'Gold Spot'}
			  }
			}		
		";
		
		=======
		OUTPUT
		=======
		echo drawMaterialChart ("นำเข้า/ส่งออก", "หน่วย (KG)", 1200, 400, $series_imex, $bs, $options);

		=======
		TYPE
		=======
		LineChart
		PieChart
	*/
	function dataset ($label, $data) {

		$dataset = "[ '$label' ";
		foreach ($data as $key => $value) {
			$dataset .= "," . $value;
		}
		$dataset .= "],";

		return $dataset;
	}

	function addColumn ($name, $type = 'number', $role = '') {
		if ($role == '' ) 	return "data.addColumn ('$type', '$name'); ";
		else 				return "data.addColumn ({type:'$type', role:'$role'});";
	}

	
																				// PIE NOT YET SUPPORTED
	function drawMaterialChart ($title, $subtitle, $width, $height, $series, $data, $options = "", $type = "Line")
	{	
		// For <div> id
		$randomID = mt_rand (1,10000);
		$columns = '';

		// DATA
		foreach ($series as $name => $type)
		{	$columns .= "	data.addColumn('$type', '$name');"; 	}

		return "
		
				<script type='text/javascript'>
				google.charts.load('current', {packages:['corechart']});
				google.charts.setOnLoadCallback(drawChart);
				
				function drawChart() 
				{
					var data 		= new google.visualization.DataTable();
					$columns
					data.addRows([ $data ]);
					var options 	= { $options ,  
										chart: { title: '$title', subtitle: '$subtitle'  },
										chartArea: {'width': '80%', 'height': '80%'}    
									};
					
					var chart = new google.visualization.$type(document.getElementById('$randomID'));
					//chart.draw(data, google.charts.$type.convertOptions(options));
					chart.draw(data, options);
				}
			</script>
			<div id='$randomID'></div>";
	}
